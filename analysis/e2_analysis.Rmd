---
title: "Social Referencing and Uncertainty, Experiment 2"
author: "Emily, Benny & Mike"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    number_sections: true
---

<style type="text/css">
body, td {
   font-size: 14px;
}
code {
  font-size: 11px;
}
pre {
  font-size: 11px;
}
</style>

Data analysis for Experiment 2 of social referencing study.
Gaze is manipulated between subjects.
Three trial types: familiar, novel, mutual exclusivity

# Data preprocessing

Preliminaries.

```{r echo=FALSE}
rm(list=ls())
setwd("~/Desktop/soc_ref_uncert/analysis")
knitr::opts_chunk$set(fig.width=8, fig.height=5, 
                      echo=TRUE, warning=FALSE, message=FALSE, cache=TRUE)
suppressPackageStartupMessages(c("dplyr","langcog","tidyr","ggplot2","lme4"))
library(langcog)
library(dplyr)
library(ggplot2)
library(rjson)
library(stringr)
library(tidyr)
library(lme4)
library(xtable)
library(knitr)
library(markdown)
library(lmerTest)
library(pwr)
theme_set(theme_bw())
```

Read in files and consolidate to the same directory. 

```{r}
rm(list=ls())

d.raw <- data.frame()
files <- dir("../data_e2/coder_1")

for (f in files) {
  jf <- paste("../data_e2/coder_1/",f,sep="")
  jd <- read.csv(jf)
  
  id <- data.frame(SID = str_replace(f, ".csv", ""),
                   line = jd$phase.ordinal,
                   phase = as.numeric(jd$phase.1_2_3_4),
                   phase_onset = jd$phase.onset,
                   phase_offset = jd$phase.offset, 
                   num_looks = jd$reference.num_looks,
                   num_ques = as.numeric(jd$reference.num_ques),
                   num_sou = jd$reference.num_SOU,
                   exclude = as.numeric(jd$reference.exclude))
  d.raw <- bind_rows(d.raw, id)}
```

Read in trial info and demographics. 

```{r}
demo <- read.csv("../demo_soc_ref_uncert_exp2.csv") 
demo$age <- as.numeric(demo$age)
demo$age_years <- trunc(demo$age, digits = 0)
demo$age_months <- demo$age*12

trial_info <- read.csv("../trial_info_e2.csv")
```

Join trial info and demographics with raw data.

```{r}
d <- left_join(d.raw, demo) %>%
  dplyr::select(SID, phase, num_looks, num_ques, num_sou, exclude, age_years, age_months, line, Condition, Gaze, phase_onset, phase_offset) %>%
  mutate(phase_length = phase_offset - phase_onset) %>%
  mutate(social_ref = as.numeric(num_looks>0))%>%
  left_join(trial_info, by = c("Condition","line"))%>%
  mutate(first_half = between(trial, 1, 4))

age_months <- d %>%
  group_by(age_years) %>%
  multi_boot_standard(col = "age_months")

age_months$age_years <- factor(age_months$age_years,
levels = c(3, 4),
labels = c("three", "four"))
```

Plot social referencing by trial type (familiar, novel, mutual exclusivity) and presence of referential gaze.

Get means.
```{r}
msslooks <- filter(d, exclude == 0) %>%
  group_by(SID, phase_name, trial_type, Gaze, age_years) %>%
  summarise(num_looks = mean(num_looks))

mslooks <- filter(d, exclude == 0) %>%
  group_by(phase_name, trial_type, Gaze, age_years) %>%
  multi_boot_standard(col = "num_looks") 

msslooks$phase_name <- factor(msslooks$phase_name, levels = c("label","slide", "planning", "response"))
mslooks$phase_name <- factor(mslooks$phase_name, levels = c("label","slide", "planning", "response"))

msslooks$trial_type <- factor(msslooks$trial_type, labels = c("familiar","mutual exclusivity", "novel"))
mslooks$trial_type <- factor(mslooks$trial_type, labels = c("familiar","mutual exclusivity", "novel"))

msslooks$Gaze <- factor(msslooks$Gaze,
levels = c("gaze","no_gaze"),
labels = c("Referential gaze", "No referential gaze"))

mslooks$Gaze <- factor(mslooks$Gaze,
levels = c("gaze","no_gaze"),
labels = c("Referential gaze", "No referential gaze"))

msslooks$age_years <- factor(msslooks$age_years,
levels = c(3, 4),
labels = c("3 years", "4 years"))

mslooks$age_years <- factor(mslooks$age_years,
levels = c(3, 4),
labels = c("3 years", "4 years"))

msslooks <- msslooks %>%
  mutate(familiarity = trial_type)

mslooks <- mslooks %>%
  mutate(familiarity = trial_type)
```

Get mean questions for plots.
```{r}
mssques <- filter(d, exclude == 0) %>%
  group_by(SID, phase_name, trial_type, Gaze, age_years) %>%
  summarise(num_ques = mean(num_ques))

msques <- filter(d, exclude == 0) %>%
  group_by(phase_name, trial_type, Gaze, age_years) %>%
  multi_boot_standard(col = "num_ques") 

mssques$phase_name <- factor(mssques$phase_name, levels = c("label","slide", "planning", "response"))
msques$phase_name <- factor(msques$phase_name, levels = c("label","slide", "planning", "response"))

mssques$trial_type <- factor(mssques$trial_type, labels = c("familiar","mutual exclusivity", "novel"))
msques$trial_type <- factor(msques$trial_type, labels = c("familiar","mutual exclusivity", "novel"))

mssques$Gaze <- factor(mssques$Gaze,
levels = c("gaze","no_gaze"),
labels = c("Referential gaze", "No referential gaze"))

msques$Gaze <- factor(msques$Gaze,
levels = c("gaze","no_gaze"),
labels = c("Referential gaze", "No referential gaze"))

mssques$age_years <- factor(mssques$age_years,
levels = c(3, 4),
labels = c("3 years", "4 years"))

msques$age_years <- factor(msques$age_years,
levels = c(3, 4),
labels = c("3 years", "4 years"))

mssques <- mssques %>%
  mutate(familiarity = trial_type)

msques <- msques %>%
  mutate(familiarity = trial_type)
```

Get mean statements of ignorance for plots.
```{r}
msssou <- filter(d, exclude == 0) %>%
  group_by(SID, phase_name, trial_type, Gaze, age_years) %>%
  summarise(num_sou = mean(num_sou))

mssou <- filter(d, exclude == 0) %>%
  group_by(phase_name, trial_type, Gaze, age_years) %>%
  multi_boot_standard(col = "num_sou") 

msssou$phase_name <- factor(msssou$phase_name, levels = c("label","slide", "planning", "response"))
mssou$phase_name <- factor(mssou$phase_name, levels = c("label","slide", "planning", "response"))

msssou$trial_type <- factor(msssou$trial_type, labels = c("familiar","mutual exclusivity", "novel"))
mssou$trial_type <- factor(mssou$trial_type, labels = c("familiar","mutual exclusivity", "novel"))

msssou$Gaze <- factor(msssou$Gaze,
levels = c("gaze","no_gaze"),
labels = c("Referential gaze", "No referential gaze"))

mssou$Gaze <- factor(mssou$Gaze,
levels = c("gaze","no_gaze"),
labels = c("Referential gaze", "No referential gaze"))

msssou$age_years <- factor(msssou$age_years,
levels = c(3, 4),
labels = c("3 years", "4 years"))

mssou$age_years <- factor(mssou$age_years,
levels = c(3, 4),
labels = c("3 years", "4 years"))

msssou <- msssou %>%
  mutate(familiarity = trial_type)

mssou <- mssou %>%
  mutate(familiarity = trial_type)
```

Plots.
```{r}
#plot number of looks.
ggplot(msslooks, aes(x = phase_name, y = num_looks, 
               col = familiarity, group = trial_type)) + 
  geom_line(data = mslooks, aes(y = mean)) + 
  geom_pointrange(data = mslooks, 
                  aes(y = mean, ymin = ci_lower, ymax = ci_upper), 
                  position = position_dodge(width =.1)) + 
  facet_grid(age_years ~ Gaze) + 
  scale_y_continuous(limits=c(0,2), breaks=c(0,1,2)) +
  theme(axis.text.x = element_text(angle = 0, hjust = .5, vjust = .5))+ 
  labs(x = "Phase", y = "Number of Looks")  +
  ggthemes::theme_few() +
  langcog::scale_colour_solarized() 

#plot number of questions.
ggplot(msssou, aes(x = phase_name, y = num_sou, 
               col = familiarity, group = trial_type)) + 
  geom_line(data = mssou, aes(y = mean)) + 
  geom_pointrange(data = mssou, 
                  aes(y = mean, ymin = ci_lower, ymax = ci_upper), 
                  position = position_dodge(width =.1)) + 
  facet_grid(age_years ~ Gaze) + 
  scale_y_continuous(limits=c(0,2), breaks=c(0,1,2)) +
  theme(axis.text.x = element_text(angle = 0, hjust = .5, vjust = .5))+ 
  labs(x = "Phase", y = "Number of Statements of Uncertainty")  +
  ggthemes::theme_few() +
  langcog::scale_colour_solarized()


#plot number of statements of uncertainty.
ggplot(mssques, aes(x = phase_name, y = num_ques, 
               col = familiarity, group = trial_type)) + 
  geom_line(data = msques, aes(y = mean)) + 
  geom_pointrange(data = msques, 
                  aes(y = mean, ymin = ci_lower, ymax = ci_upper), 
                  position = position_dodge(width =.1)) + 
  facet_grid(age_years ~ Gaze) + 
  scale_y_continuous(limits=c(0,2), breaks=c(0,1,2)) +
  theme(axis.text.x = element_text(angle = 0, hjust = .5, vjust = .5))+ 
  labs(x = "Phase", y = "Number of Questions")  +
  ggthemes::theme_few() +
  langcog::scale_colour_solarized() 
```

Looks per second. Do not prefer this measure- I think response time and looking behavior are meaningfully correlated.
```{r eval= FALSE}
#get means for participants by condition for number of looks
msslooks <- filter(d, exclude == 0) %>%
  group_by(SID, phase_name, trial_type,  age_years, Gaze) %>%
  summarise(looks_sec = mean(looks_sec))

#get means and CIs across participants for number of looks
mslooks <- filter(d, exclude == 0) %>%
  group_by(phase_name, trial_type, age_years, Gaze) %>%
  multi_boot_standard(col = "looks_sec", na.rm = TRUE)

msslooks$phase_name <- factor(msslooks$phase_name, levels = c("label-begin_slide","begin_slide-end_slide","end_slide-touch","touch-release"))

mslooks$phase_name <- factor(mslooks$phase_name, levels = c("label-begin_slide","begin_slide-end_slide","end_slide-touch","touch-release"))

#plot looks per second.
ggplot(msslooks, aes(x = phase_name, y = looks_sec,
               col = trial_type, group = trial_type)) +
  geom_line(data = mslooks, aes(y = mean)) +
  geom_pointrange(data = mslooks,
                  aes(y = mean, ymin = ci_lower, ymax = ci_upper),
                  position = position_dodge(width =.1)) +
  facet_grid(age_years ~Gaze) +
  ylim(c(0,1)) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = .5))
```

Timecourse of task.

```{r}
#do children look at the speaker more often in the gaze condition as the trials move forward?
msslooks_half <- filter(halfs, exclude == 0) %>%
  group_by(SID, phase_name, trial_type, Gaze, first_half) %>%
  summarise(num_looks = mean(num_looks))

mslooks_half <- filter(halfs, exclude == 0) %>%
  group_by(phase_name, trial_type, Gaze, first_half) %>%
  multi_boot_standard(col = "num_looks") 

msslooks_half$phase_name <- factor(msslooks_half$phase_name, levels = c("label","slide", "planning", "response"))
mslooks_half$phase_name <- factor(mslooks_half$phase_name, levels = c("label","slide", "planning", "response"))


#plot number of looks based on half.
ggplot(msslooks_half, aes(x = phase_name, y = num_looks, 
               col = trial_type, group = trial_type)) + 
  geom_line(data = mslooks_half, aes(y = mean)) + 
  geom_pointrange(data = mslooks_half, 
                  aes(y = mean, ymin = ci_lower, ymax = ci_upper, shape = trial_type), 
                  position = position_dodge(width =.1)) + 
  facet_grid(first_half ~ Gaze) + 
  scale_y_continuous(limits=c(0,2), breaks=c(0,1,2)) +
  theme(axis.text.x = element_text(angle = 0, hjust = .5, vjust = .5))+ 
  labs(x = "Phase", y = "Number of Looks")  +
  ggthemes::theme_few() +
  langcog::scale_colour_solarized() 
```


#Planned analyses

##T-tests.
```{r eval= FALSE}
t <- msslooks 
t$age <- str_replace(t$age_years, "3", "three")
t$age <- str_replace(t$age, "4", "four")
t <- t %>%
  spread(trial_type, num_looks)
```

###Gaze

Labeling phase

```{r eval= FALSE}
#Novel vs. Familiar, 3-year-olds 
t.test(subset(t$novel, t$phase_name == "label-begin_slide" & t$age == "three" & t$Gaze == "gaze"),subset(t$familiar, t$phase_name == "label-begin_slide" & t$age == "three" & t$Gaze == "gaze"), paired = TRUE)

#Novel vs. Mutual, 3-year-olds
t.test(subset(t$novel, t$phase_name == "label-begin_slide" & t$age == "three" & t$Gaze == "gaze"),subset(t$mutual, t$phase_name == "label-begin_slide" & t$age == "three" & t$Gaze == "gaze"), paired = TRUE)

#Familiar vs. Mutual, 3-year-olds
t.test(subset(t$familiar, t$phase_name == "label-begin_slide" & t$age == "three" & t$Gaze == "gaze"),subset(t$mutual, t$phase_name == "label-begin_slide" & t$age == "three" & t$Gaze == "gaze"), paired = TRUE)

#Novel vs. Familiar, 4-year-olds
t.test(subset(t$novel, t$phase_name == "label-begin_slide" & t$age == "four" & t$Gaze == "gaze"),subset(t$familiar, t$phase_name == "label-begin_slide" & t$age == "four" & t$Gaze == "gaze"), paired = TRUE)

#Novel vs. Mutual, 4-year-olds
t.test(subset(t$novel, t$phase_name == "label-begin_slide" & t$age == "four" & t$Gaze == "gaze"),subset(t$mutual, t$phase_name == "label-begin_slide" & t$age == "four" & t$Gaze == "gaze"), paired = TRUE)

#Familiar vs. Mutual, 4-year-olds
t.test(subset(t$familiar, t$phase_name == "label-begin_slide" & t$age == "four" & t$Gaze == "gaze"),subset(t$mutual, t$phase_name == "label-begin_slide" & t$age == "four" & t$Gaze == "gaze"), paired = TRUE)
```

Planning Phase

```{r eval= FALSE}
#Novel vs. Familiar, 3-year-olds
t.test(subset(t$novel, t$phase_name == "end_slide-touch" & t$age == "three" & t$Gaze == "gaze"),subset(t$familiar, t$phase_name == "end_slide-touch" & t$age == "three" & t$Gaze == "gaze"), paired = TRUE)

#Novel vs. Mutual, 3-year-olds
t.test(subset(t$novel, t$phase_name == "end_slide-touch" & t$age == "three" & t$Gaze == "gaze"),subset(t$mutual, t$phase_name == "end_slide-touch" & t$age == "three" & t$Gaze == "gaze"), paired = TRUE)

#Familiar vs. Mutual, 3-year-olds
t.test(subset(t$familiar, t$phase_name == "end_slide-touch" & t$age == "three" & t$Gaze == "gaze"),subset(t$mutual, t$phase_name == "end_slide-touch" & t$age == "three" & t$Gaze == "gaze"), paired = TRUE)

#Novel vs. Familiar, 4-year-olds
t.test(subset(t$novel, t$phase_name == "end_slide-touch" & t$age == "four" & t$Gaze == "gaze"),subset(t$familiar, t$phase_name == "end_slide-touch" & t$age == "four" & t$Gaze == "gaze"), paired = TRUE)

#Novel vs. Mutual, 4-year-olds*
t.test(subset(t$novel, t$phase_name == "end_slide-touch" & t$age == "four" & t$Gaze == "gaze"),subset(t$mutual, t$phase_name == "end_slide-touch" & t$age == "four" & t$Gaze == "gaze"), paired = TRUE)

#Familiar vs. Mutual, 4-year-olds
t.test(subset(t$familiar, t$phase_name == "end_slide-touch" & t$age == "four" & t$Gaze == "gaze"),subset(t$mutual, t$phase_name == "end_slide-touch" & t$age == "four" & t$Gaze == "gaze"), paired = TRUE)
```

Response phase

```{r eval= FALSE}
#Novel vs. Familiar, 3-year-olds **
t.test(subset(t$novel, t$phase_name == "touch-release" & t$age == "three" & t$Gaze == "gaze"),subset(t$familiar, t$phase_name == "touch-release" & t$age == "three" & t$Gaze == "gaze"), paired = TRUE)

#Novel vs. Mutual, 3-year-olds **
t.test(subset(t$novel, t$phase_name == "touch-release" & t$age == "three" & t$Gaze == "gaze"),subset(t$mutual, t$phase_name == "touch-release" & t$age == "three" & t$Gaze == "gaze"), paired = TRUE)

#Familiar vs. Mutual, 3-year-olds
t.test(subset(t$familiar, t$phase_name == "touch-release" & t$age == "three" & t$Gaze == "gaze"),subset(t$mutual, t$phase_name == "touch-release" & t$age == "three" & t$Gaze == "gaze"), paired = TRUE)

#Novel vs. Familiar, 4-year-olds ^
t.test(subset(t$novel, t$phase_name == "touch-release" & t$age == "four" & t$Gaze == "gaze"),subset(t$familiar, t$phase_name == "touch-release" & t$age == "four" & t$Gaze == "gaze"), paired = TRUE)

#Novel vs. Mutual, 4-year-olds ^
t.test(subset(t$novel, t$phase_name == "touch-release" & t$age == "four" & t$Gaze == "gaze"),subset(t$mutual, t$phase_name == "touch-release" & t$age == "four" & t$Gaze == "gaze"), paired = TRUE)

#Familiar vs. Mutual, 4-year-olds
t.test(subset(t$familiar, t$phase_name == "touch-release" & t$age == "four" & t$Gaze == "gaze"),subset(t$mutual, t$phase_name == "touch-release" & t$age == "four" & t$Gaze == "gaze"), paired = TRUE)
```

###No gaze

Labeling phase

```{r eval= FALSE}
#Novel vs. Familiar, 3-year-olds 
t.test(subset(t$novel, t$phase_name == "label-begin_slide" & t$age == "three" & t$Gaze == "no_gaze"),subset(t$familiar, t$phase_name == "label-begin_slide" & t$age == "three" & t$Gaze == "no_gaze"), paired = TRUE)

#Novel vs. Mutual, 3-year-olds
t.test(subset(t$novel, t$phase_name == "label-begin_slide" & t$age == "three" & t$Gaze == "no_gaze"),subset(t$mutual, t$phase_name == "label-begin_slide" & t$age == "three" & t$Gaze == "no_gaze"), paired = TRUE)

#Familiar vs. Mutual, 3-year-olds
t.test(subset(t$familiar, t$phase_name == "label-begin_slide" & t$age == "three" & t$Gaze == "no_gaze"),subset(t$mutual, t$phase_name == "label-begin_slide" & t$age == "three" & t$Gaze == "no_gaze"), paired = TRUE)

#Novel vs. Familiar, 4-year-olds
t.test(subset(t$novel, t$phase_name == "label-begin_slide" & t$age == "four" & t$Gaze == "no_gaze"),subset(t$familiar, t$phase_name == "label-begin_slide" & t$age == "four" & t$Gaze == "no_gaze"), paired = TRUE)

#Novel vs. Mutual, 4-year-olds
t.test(subset(t$novel, t$phase_name == "label-begin_slide" & t$age == "four" & t$Gaze == "no_gaze"),subset(t$mutual, t$phase_name == "label-begin_slide" & t$age == "four" & t$Gaze == "no_gaze"), paired = TRUE)

#Familiar vs. Mutual, 4-year-olds
t.test(subset(t$familiar, t$phase_name == "label-begin_slide" & t$age == "four" & t$Gaze == "no_gaze"),subset(t$mutual, t$phase_name == "label-begin_slide" & t$age == "four" & t$Gaze == "no_gaze"), paired = TRUE)
```

Planning phase

```{r eval= FALSE}
#Novel vs. Familiar, 3-year-olds *
t.test(subset(t$novel, t$phase_name == "end_slide-touch" & t$age == "three" & t$Gaze == "no_gaze"),subset(t$familiar, t$phase_name == "end_slide-touch" & t$age == "three" & t$Gaze == "no_gaze"), paired = TRUE)

#Novel vs. Mutual, 3-year-olds
t.test(subset(t$novel, t$phase_name == "end_slide-touch" & t$age == "three" & t$Gaze == "no_gaze"),subset(t$mutual, t$phase_name == "end_slide-touch" & t$age == "three" & t$Gaze == "no_gaze"), paired = TRUE)

#Familiar vs. Mutual, 3-year-olds
t.test(subset(t$familiar, t$phase_name == "end_slide-touch" & t$age == "three" & t$Gaze == "no_gaze"),subset(t$mutual, t$phase_name == "end_slide-touch" & t$age == "three" & t$Gaze == "no_gaze"), paired = TRUE)

#Novel vs. Familiar, 4-year-olds
t.test(subset(t$novel, t$phase_name == "end_slide-touch" & t$age == "four" & t$Gaze == "no_gaze"),subset(t$familiar, t$phase_name == "end_slide-touch" & t$age == "four" & t$Gaze == "no_gaze"), paired = TRUE)

#Novel vs. Mutual, 4-year-olds
t.test(subset(t$novel, t$phase_name == "end_slide-touch" & t$age == "four" & t$Gaze == "no_gaze"),subset(t$mutual, t$phase_name == "end_slide-touch" & t$age == "four" & t$Gaze == "no_gaze"), paired = TRUE)

#Familiar vs. Mutual, 4-year-olds
t.test(subset(t$familiar, t$phase_name == "end_slide-touch" & t$age == "four" & t$Gaze == "no_gaze"),subset(t$mutual, t$phase_name == "end_slide-touch" & t$age == "four" & t$Gaze == "no_gaze"), paired = TRUE)
```

Response phase

```{r eval= FALSE}
#Novel vs. Familiar, 3-year-olds *
t.test(subset(t$novel, t$phase_name == "touch-release" & t$age == "three" & t$Gaze == "no_gaze"),subset(t$familiar, t$phase_name == "touch-release" & t$age == "three" & t$Gaze == "no_gaze"), paired = TRUE)

#Novel vs. Mutual, 3-year-olds
t.test(subset(t$novel, t$phase_name == "touch-release" & t$age == "three" & t$Gaze == "no_gaze"),subset(t$mutual, t$phase_name == "touch-release" & t$age == "three" & t$Gaze == "no_gaze"), paired = TRUE)

#Familiar vs. Mutual, 3-year-olds *
t.test(subset(t$familiar, t$phase_name == "touch-release" & t$age == "three" & t$Gaze == "no_gaze"),subset(t$mutual, t$phase_name == "touch-release" & t$age == "three" & t$Gaze == "no_gaze"), paired = TRUE)

#Novel vs. Familiar, 4-year-olds **
t.test(subset(t$novel, t$phase_name == "touch-release" & t$age == "four" & t$Gaze == "no_gaze"),subset(t$familiar, t$phase_name == "touch-release" & t$age == "four" & t$Gaze == "no_gaze"), paired = TRUE)

#Novel vs. Mutual, 4-year-olds *
t.test(subset(t$novel, t$phase_name == "touch-release" & t$age == "four" & t$Gaze == "no_gaze"),subset(t$mutual, t$phase_name == "touch-release" & t$age == "four" & t$Gaze == "no_gaze"), paired = TRUE)

#Familiar vs. Mutual, 4-year-olds **
t.test(subset(t$familiar, t$phase_name == "touch-release" & t$age == "four" & t$Gaze == "no_gaze"),subset(t$mutual, t$phase_name == "touch-release" & t$age == "four" & t$Gaze == "no_gaze"), paired = TRUE)
```

```{r}
lmer_data <- d %>%
  filter(!exclude) %>%
  mutate(trial_type = factor(trial_type), 
         age_c = as.numeric(langcog::scale(age_months, scale=FALSE)),
         phase_name = factor(phase_name), 
         gaze = factor(Gaze))

maximal_mod <- lmer(num_looks ~ trial_type *  age_c * gaze * phase_name +
                           (trial_type | SID), 
                         data = lmer_data)

g_lm <- summary(maximal_mod)
```


```{r eval= FALSE}
lmer_data <- d %>%
  filter(!exclude) %>%
  mutate(trial_type = factor(trial_type), 
         age_c = as.numeric(langcog::scale(age_months, scale=FALSE)),
         phase_name = factor(phase_name), 
         gaze = factor(Gaze))

maximal_mod <- lmer(num_ques ~ trial_type *  age_c * gaze * phase_name +
                           (trial_type | SID), 
                         data = lmer_data)

g_lm <- summary(maximal_mod)
```


Reliability within trial type.

```{r}
wide.novel <- d %>% 
  filter(trial_type == "novel", phase == "4") %>%
  dplyr::select(SID, trial, num_looks)

wide.novel$trial[wide.novel$trial == "1" | wide.novel$trial == "2"] <- "one"
wide.novel$trial[wide.novel$trial == "4" | wide.novel$trial == "5"] <- "two"
wide.novel$trial[wide.novel$trial == "7" | wide.novel$trial == "8"] <- "three"
wide.novel$trial[wide.novel$trial == "10" | wide.novel$trial == "11"] <- "four"

wide.novel <- wide.novel %>%
  spread(trial, num_looks)

alpha.nov <- as.matrix(dplyr::select(wide.novel, -SID))
alpha(x = alpha.nov)


wide.familiar <- d %>% 
  filter(trial_type == "familiar", phase == "4") %>%
  dplyr::select(SID, trial, num_looks)

wide.familiar$trial[wide.familiar$trial == "1" | wide.familiar$trial == "3"] <- "one"
wide.familiar$trial[wide.familiar$trial == "4" | wide.familiar$trial == "6"] <- "two"
wide.familiar$trial[wide.familiar$trial == "7" | wide.familiar$trial == "9"] <- "three"
wide.familiar$trial[wide.familiar$trial == "10" | wide.familiar$trial == "12"] <- "four"

wide.familiar <- wide.familiar %>%
  spread(trial, num_looks)

alpha.fam <- as.matrix(dplyr::select(wide.familiar, -SID))
alpha(x = alpha.fam)


pwr.r.test(n = , r = .3, sig.level = .05, power = .80)
```

timecourse of task.
```{r}
lmer_data_trial <- d %>%
  filter(!exclude) %>%
  mutate(trial_type = factor(trial_type), 
         age_c = as.numeric(langcog::scale(age_months, scale=FALSE)),
         phase_name = factor(phase_name), 
         trial = as.numeric(trial),
         gaze = factor(Gaze))

summary(lmer(num_looks ~  age_c * gaze * trial +
                           (1 | SID), 
                         data = filter(lmer_data_halfs, trial_type == "novel", phase_name == "response")))
```




#Conclusions
